//
//  VulnerabilityCheckViewController.swift
//  KURSOVAYA
//
//  Created by Denis Ravkin on 03.01.2021.
//

import UIKit

class VulnerabilityCheckViewController: UIViewController {

    @IBOutlet weak var jailbreakLabel: UILabel!
    @IBOutlet weak var emulatorLabel: UILabel!
    @IBOutlet weak var debuggerLabel: UILabel!
    @IBOutlet weak var reToolsLabel: UILabel!
    
    override func viewDidLoad() {
        super.viewDidLoad()
    }
    
    override func viewDidAppear(_ animated: Bool) {
        let startTime = CFAbsoluteTimeGetCurrent()
        checkJailbreak()
        checkEmulator()
        checkDebugger()
        checkRETools()
        let time = CFAbsoluteTimeGetCurrent() - startTime
        print(time)
    }
     
     func checkJailbreak() {
         let jailbreakStatus = IOSSecuritySuite.amIJailbrokenWithFailMessage()
         
         if jailbreakStatus.jailbroken {
             jailbreakLabel.text = "Виявлен Jailbreak"
             jailbreakLabel.backgroundColor = UIColor.red
         } else {
             jailbreakLabel.backgroundColor = UIColor.green
             jailbreakLabel.text = "Jailbreak не виявлен"
         }
     }
    
    func checkEmulator() {
        let runInEmulator = IOSSecuritySuite.amIRunInEmulator() ? true : false
        
        if runInEmulator {
            emulatorLabel.backgroundColor = UIColor.red
            emulatorLabel.text = "Виявлен эмулятор"
        } else {
            emulatorLabel.backgroundColor = UIColor.green
            emulatorLabel.text = "Емулятор не виявлен"
        }
    }
    
    func checkDebugger() {
        let amIDebugged = IOSSecuritySuite.amIDebugged() ? true : false
        
        if amIDebugged {
            debuggerLabel.backgroundColor = UIColor.red
            debuggerLabel.text = "Виявлен дебагер"
        } else {
            debuggerLabel.backgroundColor = UIColor.green
            debuggerLabel.text = "Дебагер не виявлен"
        }
    }
    
    func checkRETools() {
        let amIReverseEngineered = IOSSecuritySuite.amIReverseEngineered() ? true : false
        
        if amIReverseEngineered {
            reToolsLabel.backgroundColor = UIColor.red
            reToolsLabel.text = "Виявлені RE Tools"
        } else {
            reToolsLabel.backgroundColor = UIColor.green
            reToolsLabel.text = "RE tools не виявлені"
        }
    }
}
